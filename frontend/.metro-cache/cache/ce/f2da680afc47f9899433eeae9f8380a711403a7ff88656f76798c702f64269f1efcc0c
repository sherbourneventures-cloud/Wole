{"dependencies":[{"name":"idb","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":15},"end":{"line":3,"column":29,"index":44}}],"key":"ZdmQBrZzT62w6Zx/DDxYP061LXc=","exportNames":["*"],"imports":1}},{"name":"../AsyncStorageError.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":45},"end":{"line":4,"column":60,"index":105}}],"key":"eJw0iZFo8wG6BE399IdmtcIdg/M=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _idb = require(_dependencyMap[0], \"idb\");\n  var _AsyncStorageErrorJs = require(_dependencyMap[1], \"../AsyncStorageError.js\");\n  const WebStorageTableName = \"entries\";\n  /**\n   * Registry to keep one IndexedDB connection per database name.\n   */\n  class IndexedDBConnectionRegistry {\n    registry = new Map();\n    TableName = WebStorageTableName;\n    getOrCreate(dbName) {\n      if (this.registry.has(dbName)) {\n        return this.registry.get(dbName);\n      }\n      const db = (0, _idb.openDB)(dbName, 1, {\n        upgrade: db => {\n          if (!db.objectStoreNames.contains(WebStorageTableName)) {\n            db.createObjectStore(WebStorageTableName);\n          }\n        },\n        blocked: (currentVersion, blockedVersion, _) => {\n          throw _AsyncStorageErrorJs.AsyncStorageError.jsError(`New version (${blockedVersion}) is blocked by current one (${currentVersion})`, _AsyncStorageErrorJs.AsyncStorageError.Type.WebStorageError);\n        },\n        blocking: (currentVersion, blockedVersion, _) => {\n          throw _AsyncStorageErrorJs.AsyncStorageError.jsError(`Current db version (${currentVersion}) is blocking upgrade to next version (${blockedVersion})`, _AsyncStorageErrorJs.AsyncStorageError.Type.WebStorageError);\n        }\n      });\n      this.registry.set(dbName, db);\n\n      // in case of error while opening, clear the storage to retry\n      db.catch(err => {\n        this.registry.delete(dbName);\n        throw err;\n      });\n      return db;\n    }\n  }\n  var _default = new IndexedDBConnectionRegistry();\n});","lineCount":50,"map":[[2,2,1,0],[2,14,1,12],[4,2,1,13,"Object"],[4,8,1,13],[4,9,1,13,"defineProperty"],[4,23,1,13],[4,24,1,13,"exports"],[4,31,1,13],[5,4,1,13,"value"],[5,9,1,13],[6,2,1,13],[7,2,39,0,"Object"],[7,8,39,0],[7,9,39,0,"defineProperty"],[7,23,39,0],[7,24,39,0,"exports"],[7,31,39,0],[8,4,39,0,"enumerable"],[8,14,39,0],[9,4,39,0,"get"],[9,7,39,0],[9,18,39,0,"get"],[9,19,39,0],[10,6,39,0],[10,13,39,0,"_default"],[10,21,39,0],[11,4,39,0],[12,2,39,0],[13,2,3,0],[13,6,3,0,"_idb"],[13,10,3,0],[13,13,3,0,"require"],[13,20,3,0],[13,21,3,0,"_dependencyMap"],[13,35,3,0],[14,2,4,0],[14,6,4,0,"_AsyncStorageErrorJs"],[14,26,4,0],[14,29,4,0,"require"],[14,36,4,0],[14,37,4,0,"_dependencyMap"],[14,51,4,0],[15,2,5,0],[15,8,5,6,"WebStorageTableName"],[15,27,5,25],[15,30,5,28],[15,39,5,37],[16,2,6,0],[17,0,7,0],[18,0,8,0],[19,2,9,0],[19,8,9,6,"IndexedDBConnectionRegistry"],[19,35,9,33],[19,36,9,34],[20,4,10,2,"registry"],[20,12,10,10],[20,15,10,13],[20,19,10,17,"Map"],[20,22,10,20],[20,23,10,21],[20,24,10,22],[21,4,11,2,"TableName"],[21,13,11,11],[21,16,11,14,"WebStorageTableName"],[21,35,11,33],[22,4,12,2,"getOrCreate"],[22,15,12,13,"getOrCreate"],[22,16,12,14,"dbName"],[22,22,12,20],[22,24,12,22],[23,6,13,4],[23,10,13,8],[23,14,13,12],[23,15,13,13,"registry"],[23,23,13,21],[23,24,13,22,"has"],[23,27,13,25],[23,28,13,26,"dbName"],[23,34,13,32],[23,35,13,33],[23,37,13,35],[24,8,14,6],[24,15,14,13],[24,19,14,17],[24,20,14,18,"registry"],[24,28,14,26],[24,29,14,27,"get"],[24,32,14,30],[24,33,14,31,"dbName"],[24,39,14,37],[24,40,14,38],[25,6,15,4],[26,6,16,4],[26,12,16,10,"db"],[26,14,16,12],[26,17,16,15],[26,21,16,15,"openDB"],[26,25,16,21],[26,26,16,21,"openDB"],[26,32,16,21],[26,34,16,22,"dbName"],[26,40,16,28],[26,42,16,30],[26,43,16,31],[26,45,16,33],[27,8,17,6,"upgrade"],[27,15,17,13],[27,17,17,15,"db"],[27,19,17,17],[27,23,17,21],[28,10,18,8],[28,14,18,12],[28,15,18,13,"db"],[28,17,18,15],[28,18,18,16,"objectStoreNames"],[28,34,18,32],[28,35,18,33,"contains"],[28,43,18,41],[28,44,18,42,"WebStorageTableName"],[28,63,18,61],[28,64,18,62],[28,66,18,64],[29,12,19,10,"db"],[29,14,19,12],[29,15,19,13,"createObjectStore"],[29,32,19,30],[29,33,19,31,"WebStorageTableName"],[29,52,19,50],[29,53,19,51],[30,10,20,8],[31,8,21,6],[31,9,21,7],[32,8,22,6,"blocked"],[32,15,22,13],[32,17,22,15,"blocked"],[32,18,22,16,"currentVersion"],[32,32,22,30],[32,34,22,32,"blockedVersion"],[32,48,22,46],[32,50,22,48,"_"],[32,51,22,49],[32,56,22,54],[33,10,23,8],[33,16,23,14,"AsyncStorageError"],[33,36,23,31],[33,37,23,31,"AsyncStorageError"],[33,54,23,31],[33,55,23,32,"jsError"],[33,62,23,39],[33,63,23,40],[33,79,23,56,"blockedVersion"],[33,93,23,70],[33,125,23,102,"currentVersion"],[33,139,23,116],[33,142,23,119],[33,144,23,121,"AsyncStorageError"],[33,164,23,138],[33,165,23,138,"AsyncStorageError"],[33,182,23,138],[33,183,23,139,"Type"],[33,187,23,143],[33,188,23,144,"WebStorageError"],[33,203,23,159],[33,204,23,160],[34,8,24,6],[34,9,24,7],[35,8,25,6,"blocking"],[35,16,25,14],[35,18,25,16,"blocking"],[35,19,25,17,"currentVersion"],[35,33,25,31],[35,35,25,33,"blockedVersion"],[35,49,25,47],[35,51,25,49,"_"],[35,52,25,50],[35,57,25,55],[36,10,26,8],[36,16,26,14,"AsyncStorageError"],[36,36,26,31],[36,37,26,31,"AsyncStorageError"],[36,54,26,31],[36,55,26,32,"jsError"],[36,62,26,39],[36,63,26,40],[36,86,26,63,"currentVersion"],[36,100,26,77],[36,142,26,119,"blockedVersion"],[36,156,26,133],[36,159,26,136],[36,161,26,138,"AsyncStorageError"],[36,181,26,155],[36,182,26,155,"AsyncStorageError"],[36,199,26,155],[36,200,26,156,"Type"],[36,204,26,160],[36,205,26,161,"WebStorageError"],[36,220,26,176],[36,221,26,177],[37,8,27,6],[38,6,28,4],[38,7,28,5],[38,8,28,6],[39,6,29,4],[39,10,29,8],[39,11,29,9,"registry"],[39,19,29,17],[39,20,29,18,"set"],[39,23,29,21],[39,24,29,22,"dbName"],[39,30,29,28],[39,32,29,30,"db"],[39,34,29,32],[39,35,29,33],[41,6,31,4],[42,6,32,4,"db"],[42,8,32,6],[42,9,32,7,"catch"],[42,14,32,12],[42,15,32,13,"err"],[42,18,32,16],[42,22,32,20],[43,8,33,6],[43,12,33,10],[43,13,33,11,"registry"],[43,21,33,19],[43,22,33,20,"delete"],[43,28,33,26],[43,29,33,27,"dbName"],[43,35,33,33],[43,36,33,34],[44,8,34,6],[44,14,34,12,"err"],[44,17,34,15],[45,6,35,4],[45,7,35,5],[45,8,35,6],[46,6,36,4],[46,13,36,11,"db"],[46,15,36,13],[47,4,37,2],[48,2,38,0],[49,2,39,0],[49,6,39,0,"_default"],[49,14,39,0],[49,17,39,15],[49,21,39,19,"IndexedDBConnectionRegistry"],[49,48,39,46],[49,49,39,47],[49,50,39,48],[50,0,39,49],[50,3]],"functionMap":{"names":["<global>","IndexedDBConnectionRegistry","getOrCreate","openDB$argument_2.upgrade","openDB$argument_2.blocked","openDB$argument_2.blocking","db._catch$argument_0"],"mappings":"AAA;ACQ;ECG;eCK;ODI;eEC;OFE;gBGC;OHE;aIK;KJG;GDE;CDC"},"hasCjsExports":false},"type":"js/module"}]}